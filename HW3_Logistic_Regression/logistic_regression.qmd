---
title: Logistic and Multinomial Logistic Regression
format: html
editor: visual
---

**Model: Regressing binary dependent variable, `DRINKING_D`, on the following binary and continuous predictors: `FATAL_OR_M`, `OVERTURNED`, `CELL_PHONE`, `SPEEDING`, `AGGRESSIVE`, `DRIVER1617`, `DRIVER65PLUS`, `PCTBACHMOR`, and `MEDHHINC`.**

Prior to running any of the analyses, be sure to set the working directory using the `setwd` command, install the relevant R packages using the `install.packages` command, and load the relevant packages using the `library` command.

```{r setup}
library(aod)
library(ggplot2)
library(rms)
library(gmodels)
library(nnet)
library(DAAG)
library(ROCR)
library(xtable)

options(scipen = 999)
```

*2.* Import the file `logistic_regression.csv` into R using the `read.csv` command. Now, you are ready to do some exploratory analyses.

```{r load data}
cdc_data <- read.csv("data/logistic_regression.csv")

head(cdc_data)
```

*2.a.* Using the table and prop.table commands, tabulate the dependent variable, `DRINKING_D.`

```{r tabulate}
DRINKING_D.tab <- table(cdc_data$DRINKING_D)

prop.table(DRINKING_D.tab)
```

In your report, in addition to the counts that you can obtain with the table command, you will be asked to report the proportion of crashes that involved a drunk driver using the prop.table command as above.

*2.b.* Using the CrossTable command in the gmodels library, examine the cross-tabulations between the dependent variable, `DRINKING_D`, and the following binary predictor variables: `FATAL_OR_M`, `OVERTURNED`, `CELL_PHONE`, `SPEEDING`, `AGGRESSIVE`, `DRIVER1617`, and `DRIVER65PLUS`.

*2.b.i.* For the first predictor (`FATAL_OR_M`), record the number and percentage of 1-responses (i.e., fatalities or major injuries) for both categories of the variable `DRINKING_D`, as well as the total number of 1-responses (i.e., fatalities or major injuries) in the data set. That is, how many fatalities or major injuries were there when the driver wasn’t inebriated, when the driver was inebriated, and altogether?

*2.b.ii.* Repeat step 2.b.i above for the rest of the binary predictors.

```{r cross-tabulations}
# I made a function to loop through it so I don't have to do this 7 separate times.
predictors <- c(
  "FATAL_OR_M", "OVERTURNED", "CELL_PHONE",
  "SPEEDING", "AGGRESSIVE",
  "DRIVER1617", "DRIVER65PLUS"
  )

for (var in predictors) {
  cat("============================================================\n")
  cat("PREDICTOR:", var, "\n")
  
  # Counts.
  table_counts <- table(cdc_data$DRINKING_D, cdc_data[[var]])
  print(table_counts)
  
  # Row percentages within DRINKING_D.
  cat("\nROW % WITHIN DRINKING_D:\n")
  print(round(prop.table(table_counts, 1), 4))
  
  # Total number of predictors = 1 in the entire dataset.
  cat("\nTOTAL", var, "= 1 IN FULL DATASET:", sum(cdc_data[[var]] == 1), "\n")
  
  cat("\nCROSSTABLE OUTPUT:")
  CrossTable(cdc_data$DRINKING_D,
             cdc_data[[var]],
             prop.r = FALSE,
             prop.t = FALSE,
             prop.chisq = FALSE,
             chisq = TRUE)
}
```

*2.b.iii.* In your report, you will be asked to present the cross-tabulations from 2.b.i and 2.b.ii in a table.

*2.b.iv.* Prior to doing predictive modeling, statisticians often use the Chi-Square (χ2) test to determine whether the distribution of one categorical variable varies with respect to the values of another categorical variable. If we were to look at a cross-tabulation of the variables DRINKING_D and FATAL_OR_M, the null and alternative hypotheses for the χ2 test would be as follows:

*H0:* The proportion of fatalities for crashes that involve drunk drivers is the same as the proportion of fatalities for crashes that don’t involve drunk drivers.

vs.

*Ha:* The proportion of fatalities for crashes that involve drunk drivers is different than the proportion of fatalities for crashes that don’t involve drunk drivers.

As usual, a high value of the χ2 statistic, and a p-value lower than 0.05 suggest that there’s evidence to reject the null hypothesis in favor of the alternative, and that there’s an association between drunk driving and crash fatalities.

*2.b.iv.1.* To carry out the χ2 test in R to test the hypothesis above, you would use the syntax `CrossTable(cdc_data$FATAL_OR_M, cdc_data$DRINKING_D, prop.r = FALSE, prop.t = FALSE, prop.chisq = FALSE, chisq = TRUE)`. The χ2 results will appear below the cross-tabulation table that you have seen in 2.b.i above. Report the results without the Yates Continuity Correction.

*2.b.iv.2.* Modifying the syntax in 2.b.iv.1 above, run the χ2 test examining the association between the dependent variable and the remaining binary predictors.

*2.b.iv.3.* In the table 2.b.iii above, add another column called “χ2 p-value”. For each row, present the p-value from the corresponding χ2 test.

*2.b.iv.3.a.* Note, however, that in practice, statisticians generally present not just the p-value, but also the value of the χ2 statistic and the degrees of freedom, which is the parameter of the χ2 distribution. The degrees of freedom is calculated as (R − 1)(C − 1), where R is the number of rows in the cross-tabulation table and C is the number of columns in the cross-tabulation table. Said differently, R is the number of categories of the first variable and C is the number of categories in the second variable. Here, because we are cross-tabulating two binary variables, both R and C are 2, and df = (R − 1)(C − 1) = 1.

*2.c.* Now, let’s examine whether the means of the two continuous predictors seem to differ for the different levels of the dependent variable. To do this, calculate the group means (and standard deviations) of both predictors (`PCTBACHMOR` and `MEDHHINC`) for crashes that involve drunk drivers and crashes that don’t.

*2.c.i.* In order to do this in R, use the `tapply` command. For instance, if you want to calculate the average values of the variable `PCTBACHMOR` for crashes that involve drunk drivers and crashes that don’t, you would use the following syntax: `tapply(cdc_data$PCTBACHMOR, cdc_data$DRINKING_D, mean)`. To calculate the standard deviations of the variable `PCTBACHMOR` for crashes that involve drunk drivers and crashes that don’t, you would use the following syntax: `tapply(cdc_data$PCTBACHMOR, cdc_data$DRINKING_D, sd)`.

*2.c.ii.* Present your results in a table.

*2.c.iii.* Recall from introductory statistics classes that in order to compare the mean value of a continuous variable for two independent groups, statisticians usually employ a test that’s called the independent samples t-test. For example, we can see whether the average `PCTBACHMOR` values are statistically significantly different for crashes that involve drunk drivers and crashes that don’t. The null and alternative hypotheses for the independent samples t-test would be as follows:

*H0:* average values of the variable `PCTBACHMOR` are the same for crashes that involve drunk drivers and crashes that don’t.

vs.

*Ha:* average values of the variable `PCTBACHMOR` are different for crashes that involve drunk drivers and crashes that don’t.

A high value of the t-statistic, and a p-value lower than 0.05 suggest that there’s evidence to reject the null hypothesis in favor of the alternative.

*2.c.iii.1.* To carry out the t-test in R to test the hypothesis above, you would use the syntax `t.test(mydata$PCTBACHMOR~mydata$DRINKING_D)`.

*2.c.iii.2.* Repeat the t-test for the variable `MEDHHINC.`

*2.c.iii.3.* In the table 2.c.ii above, add another column called “t-test pvalue”. For each row, present the p-value from the corresponding t-test.

*2.c.iii.3.a.* Note, however, that in practice, statisticians generally present not just the p-value, but also the value of the t-statistic and the degrees of freedom.

*2.d.* Using the instructions from Assignment 1, examine the Pearson correlations between all the predictors (both binary and continuous). Is there evidence of severe multicollinearity here? (Be sure the appropriate R library is loaded).